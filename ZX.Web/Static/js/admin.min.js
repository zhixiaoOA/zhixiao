(function ($) {
    $.admin = {
        selectValue: "", //返回id
        selectText: "", //返回值
        selectTextValue: "", //返回id和值
        isRefurbish: false,//是否刷新页面
        isCallback: false,//是否回调
        //控制checkbox选中或取消选中
        onSelectCbox: function (clickCbox, attrName, attrValue) {
            var bl = $(clickCbox).prop("checked") ? true : false;
            $("input[" + attrName + "='" + attrValue + "']").prop("checked", bl);
        },
        //反选
        onCounterSelectCbox: function (attrName, attrValue) {
            $.each($("input[" + attrName + "='" + attrValue + "']"), function (i, item) {
                $(item).prop("checked", $(item).prop("checked") ? false : true);
            });
        },
        //获取所有选中checkbox值
        getCboxVal: function (cboxList) {
            var objValue = "";
            $(cboxList).each(function () {
                if ($(this).prop("checked")) {
                    objValue += $(this).val() + ",";
                }
            });
            if (objValue != "") {
                objValue = objValue.substring(0, objValue.length - 1);
            }
            return objValue;
        },
        //获取所有checkbox值
        getCboxVals: function (cboxList, attrName) {
            var objValue = "";
            $(cboxList).each(function () {
                if ($(this).prop("checked")) {
                    objValue += $(this).attr(attrName) + ",";
                }
            });
            if (objValue != "") {
                objValue = objValue.substring(0, objValue.length - 1);
            }
            return objValue;
        },
        //keyPress、keyUp、keyBlur控制文本只能输入小数和整数
        keyPress: function (obj) {
            if (!obj.value.match(/^[\+\-]?\d*?\.?\d*?$/)) {
                obj.value = obj.t_value != undefined ? obj.t_value : "";
            }
            else {
                obj.t_value = obj.value;
            }
            if (obj.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?)?$/)) {
                obj.o_value = obj.value;
            }
        },
        keyUp: function (obj) {
            if (!obj.value.match(/^[\+\-]?\d*?\.?\d*?$/)) {
                obj.value = obj.t_value != undefined ? obj.t_value : "";
            } else {
                obj.t_value = obj.value;
            }
            if (obj.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?)?$/)) {
                obj.o_value = obj.value;
            }
        },
        keyBlur: function (obj) {
            if (!obj.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?|\.\d*?)?$/)) {
                obj.value = obj.o_value != undefined ? obj.o_value : "";
            } else {
                if (obj.value.match(/^\.\d+$/)) {
                    obj.value = 0 + obj.value;
                }
                if (obj.value.match(/^\.$/)) {
                    obj.value = 0;
                    obj.o_value = obj.value;
                }
            }
        },
        showMask: function () {
            $(".mask").css("height", $(document).height());
            $(".mask").css("width", $(document).width());
            $(".mask").show();
        },
        hideMask: function () {
            $(".mask").hide();
        },
        //获取url参数
        getQueryString: function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        },
        //获得唯一值
        getGuid: function () {
            var vguid = "";
            var vdate = new Date();
            vguid += vdate.getFullYear(); //获取年
            vguid += (vdate.getMonth() + 1); //获取月
            vguid += vdate.getDate(); //获取日
            vguid += vdate.getHours(); //获取小时
            vguid += vdate.getMinutes(); //获取分钟
            vguid += vdate.getSeconds(); //获取秒
            vguid += vdate.getMilliseconds(); //获取毫秒
            return vguid;
        },
        //获得当前时间
        getDate: function (fmt) {
            var myDate = new Date();
            var dyear = myDate.getYear();//获取当前年份(2位)     
            var cyear = myDate.getFullYear();//获取完整的年份(4位,1970-????)    
            var month = myDate.getMonth() + 1;//获取当前月份(0-11,0代表1月)    
            var date = myDate.getDate();//获取当前日(1-31)
            var day = myDate.getDay();//获取当前星期X(0-6,0代表星期天)     
            var time = myDate.getTime();//获取当前时间(从1970.1.1开始的毫秒数)    
            var hours = myDate.getHours();//获取当前小时数(0-23)    
            var minute = myDate.getMinutes();//获取当前分钟数(0-59)    
            var second = myDate.getSeconds();//获取当前秒数(0-59)    
            var millsecond = myDate.getMilliseconds();//获取当前毫秒数(0-999)    
            var ddate = myDate.toLocaleDateString();//获取当前日期     
            var dtime = myDate.toLocaleTimeString(); //获取当前时间    
            var ddatetime = myDate.toLocaleString();//获取日期与时间
            if (fmt) {
                if (fmt == "yyyy-MM-dd") return cyear + "-" + month + "-" + date;
                if (fmt == "yyyy-MM-dd HH:mm:ss") return cyear + "-" + month + "-" + date + " " + hours + ":" + minute + ":" + second;
                if (fmt = "yyyy-MM") return cyear + "-" + month;
                if (fmt == "MM-dd") return month + "-" + date;
                if (fmt == "HH:mm:ss") return hours + ":" + minute + ":" + second;
                if (fmt == "HH:mm") return hours + ":" + minute;
                return cyear + "-" + month + "-" + date;
            } else {
                return cyear + "-" + month + "-" + date;
            }
        },
        //获取两个时间差
        getDateDiff: function (startTime, endTime, diffType) {
            startTime = startTime.replace(/-/g, "/");
            endTime = endTime.replace(/-/g, "/");
            diffType = diffType.toLowerCase();
            var sTime = new Date(startTime);
            var eTime = new Date(endTime);
            var divNum = 1;
            switch (diffType) {
                case "ss":
                    divNum = 1000;
                    break;
                case "mm":
                    divNum = 1000 * 60;
                    break;
                case "hh":
                    divNum = 1000 * 3600;
                    break;
                case "dd":
                    divNum = 1000 * 3600 * 24;
                    break;
                default:
                    break;
            }
            return parseInt((eTime.getTime() - sTime.getTime()) / parseInt(divNum));
        },
        //验证手机号码是否正确
        IsMobile: function (mobile) {
            var myreg = /^(((14[0-9]{1})|(17[0-9]{1})|(13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
            if (!myreg.test(mobile)) {
                return false;
            }
            return true;
        },
        //控制角色操作权限
        //roleId 角色Id
        //pageCode页面编码
        operUserRole: function (roleId, actionCode) {
            $.post("/ActionRole/GetOperButton", { roleId: roleId, actionCode: actionCode }, function (data) {
                if (data) {
                    $.each(data, function (i, item) {
                        if (item.IsNameOper) {//.removeAttr("disabled")
                            $("" + item.ButtonType + "[name='" + item.ButtonName + "']").show();
                        } else {
                            $("#" + item.ButtonId).show();
                        }
                    });
                }
            }, "json");
        },
        //弹窗提示信息
        onConfirm: function (content, objFun) {
            var api = null, W = null;
            try { api = frameElement.api; } catch (e) { api = null; }
            if (api != null) {
                W = api.opener;
                W.$.dialog(
                    {
                        id: "onConfirm1",
                        icon: 'prompt.gif',
                        title: "提示",
                        resize: false,
                        width: 250,
                        content: content,
                        max: false,
                        min: false,
                        fixed: true,
                        ok: function () {
                            eval(objFun);
                        },
                        cancelVal: '取消',
                        cancel: true
                    });
            } else {
                var dialog = $.dialog(
                    {
                        id: "onConfirm2",
                        icon: 'prompt.gif',
                        title: "提示",
                        resize: false,
                        width: 250,
                        content: content,
                        max: false,
                        min: false,
                        fixed: true,
                        ok: function () {
                            eval(objFun);
                        },
                        cancelVal: '取消',
                        cancel: true
                    });
            }
            return false;
        },
        //弹窗确认和取消
        onAlert: function (context) {
            var api = null, W = null;
            try { api = frameElement.api; } catch (e) { api = null; }
            if (api != null) {
                W = api.opener;
                W.$.dialog(
                    {
                        id: "onAlert1",
                        icon: 'alert.gif',
                        title: "提示",
                        resize: false,
                        fixed: true,
                        width: 250,
                        content: context,
                        cancelVal: '确认',
                        cancel: true
                    });
            } else {
                var dialog = $.dialog(
                    {
                        id: "onAlert2",
                        icon: 'alert.gif',
                        title: "提示",
                        resize: false,
                        fixed: true,
                        width: 250,
                        content: context,
                        cancelVal: '确认',
                        cancel: true
                    });
            }
        },
        //操作成功提示框
        onSuccess: function (context, objFun) {
            var api = null, W = null;
            try { api = frameElement.api; } catch (e) { api = null; }
            if (api != null) {
                W = api.opener;
                W.$.dialog(
                    {
                        id: "onSuccess1",
                        icon: 'success.gif',
                        title: "提示",
                        resize: false,
                        fixed: true,
                        width: 250,
                        content: context,
                        cancelVal: '确认',
                        cancel: true,
                        close: function () {
                            eval(objFun);
                        }
                    });
            } else {
                var dialog = $.dialog(
                    {
                        id: "onSuccess2",
                        icon: 'success.gif',
                        title: "提示",
                        resize: false,
                        fixed: true,
                        width: 250,
                        content: context,
                        cancelVal: '确认',
                        cancel: true,
                        close: function () {
                            eval(objFun);
                        }
                    });
            }
        },
        //lhgdialog弹窗跳转页面
        //url:跳转地址,title显示标题,width窗体宽度,height窗体高度,
        //btnObj刷新按钮id
        onDialog: function (url, title, width, height, btnObj, fun) {
            var api = null, W = null;
            try { api = frameElement.api; } catch (e) { api = null; }
            if (api != null) {
                //W.$.admin.isRefurbish = true;
                W = api.opener;
                var dialog = W.$.dialog(
                    {
                        id: "onDialog1",
                        title: title,
                        content: 'url:' + url,
                        fixed: true,
                        width: width,
                        height: height,
                        lock: true,
                        min: false,
                        max: false,
                        resize: false,
                        close: function () {
                            if (W.$.admin.isRefurbish) {
                                if (btnObj != null && btnObj != "") {
                                    $("#" + btnObj).click();
                                }
                                if (fun != null && fun != undefined && fun != "") {
                                    eval(fun);
                                }
                            }
                        }
                    });
            } else {
                //$.admin.isRefurbish = true;
                var dialog = $.dialog(
                    {
                        id: "onDialog2",
                        title: title,
                        content: 'url:' + url,
                        fixed: true,
                        width: width,
                        height: height,
                        lock: true,
                        min: false,
                        max: false,
                        resize: false,
                        close: function () {
                            if ($.admin.isRefurbish) {
                                if (btnObj != null && btnObj != undefined && btnObj != "") {
                                    $("#" + btnObj).click();
                                }
                                if (fun != null && fun != undefined && fun != "") {
                                    eval(fun);
                                }
                            }
                        }
                    });
            }
        },
        //弹窗选择数据
        onDialogValue: function (url, width, height, title, valueId, textId, funName) {
            var api = null, W = null;
            try { api = frameElement.api; } catch (e) { api = null; }
            if (api != null) {
                W = api.opener;
                W.$.admin.isCallback = false;
                W.$.dialog(
                    {
                        id: "GetDialogValue1",
                        title: title,
                        content: 'url:' + url,
                        fixed: true,
                        width: width,
                        height: height,
                        min: false,
                        max: false,
                        resize: false,
                        close: function () {
                            if (W.$.admin.isCallback) {
                                W.$.admin.onSingleFun(valueId, textId, W);
                                eval(funName);
                            }
                        }
                    });
            } else {
                $.admin.isCallback = false;
                var dialog = $.dialog(
                    {
                        id: "GetDialogValue2",
                        title: title,
                        content: 'url:' + url,
                        fixed: true,
                        width: width,
                        height: height,
                        min: false,
                        max: false,
                        resize: false,
                        close: function () {
                            if ($.admin.isCallback) {
                                $.admin.onSingleFun(valueId, textId, null);
                                eval(funName);
                            }
                        }
                    });
            }
        },
        //单选回调函数
        onSingleFun: function (valueId, textId, W) {
            if (W == null) {
                if (valueId != null && valueId != "") {
                    document.getElementById(valueId).value = $.admin.selectValue;
                }
                if (textId != null && textId != "") {
                    document.getElementById(textId).value = $.admin.selectText;
                    var obj = document.getElementById(textId);
                    if ($(obj).attr("datatype") != undefined && $(obj).attr("datatype") != "") {
                        if ($(obj).val() == "") {
                            $(obj).addClass("Validform_error");
                            $(obj).siblings(".Validform_checktip").removeClass().addClass("Validform_checktip Validform_wrong").html($(obj).attr("nullmsg"));
                        } else {
                            $(obj).removeClass();
                            $(obj).siblings(".Validform_checktip").removeClass().addClass("Validform_checktip Validform_right").html("通过信息验证!");
                        }
                    }
                }
            } else {
                if (valueId != null && valueId != "") {
                    W.document.getElementById(valueId).value = W.$.admin.selectValue;
                }
                if (textId != null && textId != "") {
                    W.document.getElementById(textId).value = W.$.admin.selectText;
                    var obj = W.document.getElementById(textId);
                    if ($(obj).attr("datatype") != undefined && $(obj).attr("datatype") != "") {
                        if ($(obj).val() == "") {
                            $(obj).addClass("Validform_error");
                            $(obj).siblings(".Validform_checktip").removeClass().addClass("Validform_checktip Validform_wrong").html($(obj).attr("nullmsg"));
                        } else {
                            $(obj).removeClass();
                            $(obj).siblings(".Validform_checktip").removeClass().addClass("Validform_checktip Validform_right").html("通过信息验证!");
                        }
                    }
                }
            }
        },
        //单选数据确认
        okSingleFun: function (thisRow, cellIdIndex, cellValIndex) {
            var api = frameElement.api, W = api.opener;
            var vid = $(thisRow).find("td:eq(" + cellIdIndex
                + ")").text();
            var vname = $(thisRow).find("td:eq(" + cellValIndex + ")").text();
            W.$.admin.selectValue = $.trim(vid);
            W.$.admin.selectText = $.trim(vname).indexOf("-") > 0 ? $.trim(vname).substring($.trim(vname).indexOf("-") + 1) : $.trim(vname);
            W.$.admin.selectTextValue = $.trim(vid) + "-" + $.trim(vname);
            W.$.admin.isCallback = true;
            api.close();
        },
        //清空数据
        clearData: function () {
            var api = frameElement.api, W = api.opener;
            W.$.admin.selectValue = "";
            W.$.admin.selectText = "";
            api.close();
        },
        //确认选择
        onOkValue: function (vid, vname) {
            //$.admin.selectValue = $.trim(vid);
            //$.admin.selectText = $.trim(vname);
            //$.admin.selectTextValue = $.trim(vid) + "-" + $.trim(vname);
            //$.admin.isCallback = true;
            var api = frameElement.api, W = api.opener;
            W.$.admin.selectValue = $.trim(vid);
            W.$.admin.selectText = $.trim(vname);
            W.$.admin.selectTextValue = $.trim(vid) + "-" + $.trim(vname);
            W.$.admin.isCallback = true;
            api.close();
        },
        //关闭窗体
        onClose: function (bl) {
            var api = frameElement.api, W = api.opener;
            if (bl != undefined) {
                $.admin.isRefurbish = bl;
                W.$.admin.isRefurbish = bl;
            }
            api.close();
        },
        onTips: function (msg) {
            var api = null, W = null;
            try { api = frameElement.api; W = api.opener; } catch (e) { api = null; }
            if (api != null) {
                W.$.dialog.tips(msg, 2, '32X32/succ.png');
            } else {
                $.dialog.tips(msg, 2, '32X32/succ.png');
            }
        },
        getFormData: function (formId) {
            var data = "";
            $("#" + formId + " input[type='hidden']").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " input[type='password']").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " input[type='text']").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " input[type='checkbox']:checked").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " input[type='radio']:checked").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " select").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            $("#" + formId + " textarea").each(function () {
                data += "\"" + $(this).attr("name") + "\":\"" + $(this).val() + "\",";
            });
            if (data != "") {
                data = data.substring(0, data.length - 1);
            }
            return "{" + data + "}";
        },
        compareDate: function (d1, d2) {
            return ((new Date(d1.replace(/-/g, "\/"))) > (new Date(d2.replace(/-/g, "\/"))));
        }
    }
})(jQuery);
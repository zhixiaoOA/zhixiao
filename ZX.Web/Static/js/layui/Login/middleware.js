(function () { var e, n, t, o, i, r, a, c, l, f, p, s, u, d, h, g, m, w, x, v, b = [].indexOf || function (e) { for (var n = 0, t = this.length; n < t; n++)if (n in this && this[n] === e) return n; return -1 }; o = "https://an.danlu.net/demlution.gif", e = "/company_api/company_counter/", t = !1, n = !!window.DM_DEBUG, n && (o = "http://127.0.0.1:9001/demlution.gif"), l = function (e) { return Math.round(Math.random() * e) }, a = function (e) { var n, t; return document.cookie.length > 0 && (t = document.cookie.indexOf(e + "="), t !== -1) ? (t = t + e.length + 1, n = document.cookie.indexOf(";", t), n === -1 && (n = document.cookie.length), unescape(document.cookie.substring(t, n))) : "" }, h = function (e, n) { return document.cookie = e + "=" + escape(n) }, i = function (e) { var n; return n = a(e), n || (n = l(1e8), h(e, n)), n }, c = function (e, n) { var t; return t = new Image(1, 1), t.onload = function () { var e; if (e = 0, "function" == typeof n) return n() }, t.src = e }, d = function () { var e, n, t, r; if ("true" !== window.localStorage.disable_moddleware && !/(phantomjs|baiduspider|headlesschrome)/.test(navigator.userAgent.toLowerCase())) { n = { id: l(1e8), referer: encodeURIComponent(document.referrer), da_a: i("da_a"), width: window.screen.width, height: window.screen.height, color: screen.colorDepth, lang: navigator.browserLanguage ? navigator.browserLanguage : navigator.language, title: encodeURIComponent(document.title), token: window.DM_ANALYTICS_TOKEN || "", request_id: window.DM_REQUEST_ID, page_id: window.DM_PAGE_ID }, t = ""; for (e in n) t += "&" + e + "=" + n[e]; return r = o + "?" + t.slice(1, t.length), c(r) } }, v = function (e, n) { var t; if (window.XMLHttpRequest) t = new XMLHttpRequest; else if (window.ActiveXObject) try { t = new ActiveXObject("Msxml2.XMLHTTP") } catch (o) { try { t = new ActiveXObject("Microsoft.XMLHTTP") } catch (o) { } } if (t) return t.onreadystatechange = function () { return n(t) }, t.open("GET", e), t.setRequestHeader("X-Requested-With", "XMLHttpRequest"), t.send() }, w = function () { var n, t, o, i; if (n = document.getElementById("dm-company-counter"), t = [].slice.call(document.querySelectorAll(".dm-company-counter")), o = document.getElementById("dm-object-pageview"), i = [].slice.call(document.querySelectorAll(".dm-object-pageview")), n || o || t.length || i.length) return v(e, function (e) { var r, a, c, l, f, p, s; if (4 === e.readyState && 200 === e.status) { if (r = JSON.parse(e.responseText), n && (n.innerHTML = r.counter), o && (o.innerHTML = r.pageview), t.length) for (c = 0, f = t.length; c < f; c++)a = t[c], a.innerHTML = r.counter; if (i.length) { for (s = [], l = 0, p = i.length; l < p; l++)a = i[l], s.push(a.innerHTML = r.pageview); return s } } }) }, m = function () { var e; e = document.createElement("canvas"), e.getContext && e.getContext("2d") && (t = !(0 !== e.toDataURL("image/webp").indexOf("data:image/webp"))) }, f = function () { if ("undefined" != typeof jQuery) return $(function () { var e, n; return e = /s2\.d2scdn\.com\//i, n = /s2\.d2scdn\.com\/[^?]*$/i, $("img").lazyload({ threshold: 100, handler: function (o) { return o && t ? (o.match(n) ? o += "?imageView2/0/format/webp" : o.match(e) && (o = o.replace("/format/jpg", "/format/webp"), o = o.replace("/format/jpeg", "/format/webp")), o) : o } }) }) }, u = function () { var e, n, t, o, i; if (/__remove_href/.test(location.search)) { for (o = $("a"), i = [], n = 0, t = o.length; n < t; n++)e = o[n], $(e).removeAttr("href"), i.push($(e).click(function (e) { return !1 })); return i } }, x = function () { var e, n, t, o, i, r; if (/__legacy=true/.test(location.search) && "number" != typeof window.DM_PAGE_ID) { for (n = '<div class="a-legacy-tips" style="\n  box-sizing: border-box;\n  height: 30px;\n  line-height: 30px;\n  font-size: 12px;\n  border: 1px solid #ccc;\n  background-color: #FFEB3B;\n  color: #212121;\n  text-align: center;\n  width: 200px;\n  position: fixed;\n  top: 20px;\n  left: 20px;\n  z-index: 9999999;\n">\n  姝ｅ湪棰勮鏁寸珯妯℃澘缃戠珯\n</div>', $("body").prepend($(n)), i = $("a"), r = [], t = 0, o = i.length; t < o; t++)e = i[t], e.search ? /^\?/.test(e.search) ? r.push(e.search += "&__legacy=true") : r.push(void 0) : r.push(e.search = "?__legacy=true"); return r } }, r = function () { var e, n; if (!/^m./.test(location.host) && !/micromessenger/i.test(navigator.userAgent) && a("fshop_id") && (n = /^\/dmhome/, !n.test(location.pathname))) return e = "<style>\n  /* Styling the Popup Window */\n  .fenxiao-popup-trigger {position: fixed; bottom: 100px; left: 0; z-index: 3000; display: block; margin: 0 auto;\n    padding: 20px; width: 90px; background: #4EBD79; color: #fff; font-size: 18px; font-weight: 700;\n    text-align: center; text-transform: uppercase; line-height: 24px; cursor: pointer; }\n  .fenxiao-popup {display: none; position: fixed; bottom: 100px; left: 130px; width: 700px; padding: 7px 10px;\n    background: #fff; color: #333; font-size: 19px; line-height: 30px; border: 10px solid #4EBD79; z-index: 9999;}\n  .fenxiao-popup-mobile {position: fixed; bottom: 100px; left: 0; margin: 30px 0 0; width: 100%;}\n  .fenxiao-popup-btn-close {position: absolute; top: 8px; right: 14px; color: #4EBD79; font-size: 14px;\n    font-weight: bold; text-transform: uppercase; cursor: pointer;}\n</style>\n\n  <a class=\"fenxiao-popup-trigger\">鍒嗛攢閾炬帴</a>\n  <div class=\"fenxiao-popup\">\n    <span class=\"fenxiao-popup-fenxiao-url\"></span>\n    <span class=\"fenxiao-popup-btn-close\">鍏抽棴</span>\n    <a class='copy-fenxiao-url button'>澶嶅埗閾炬帴</a>\n  </div>\n\n<script>\nfunction addParameterToURL(param) {\n  _url = location.href.split('#')[0]\n  _url = (_url.split('?')[1] ? '&' : '?') + param\n  return _url\n}\n$('.fenxiao-popup-fenxiao-url').html(location.origin + location.pathname + location.search +\n  addParameterToURL('fshop_id=' + getCookie('fshop_id')) + location.hash)\n// Popup Window\nvar scrollTop = '';\nvar newHeight = '100';\n\n$(window).bind('scroll', function() {\n  scrollTop = $( window ).scrollTop();\n  newHeight = scrollTop + 100;\n});\nif(jQuery(window).width() < 767) {\n  $('.fenxiao-popup').show().addClass('fenxiao-popup-mobile');\n  $('fenxiao-popup-fenxiao-url').css('display', 'block')\n} else {\n  $('.fenxiao-popup').removeClass('fenxiao-popup-mobile').toggle();\n}\n$('.fenxiao-popup-trigger').click(function(e) {\n  e.stopPropagation();\n  if(jQuery(window).width() < 767) {\n    $(this).after( $( \".fenxiao-popup\" ) );\n    $('.fenxiao-popup').show().addClass('fenxiao-popup-mobile');\n  } else {\n    $('.fenxiao-popup').removeClass('fenxiao-popup-mobile').toggle();\n  };\n});\n\n$('html').click(function() {\n  $('.fenxiao-popup').hide();\n});\n\n$('.fenxiao-popup-btn-close').click(function(e){\n  $('.fenxiao-popup').hide();\n});\n\n$('.fenxiao-popup').click(function(e){\n  e.stopPropagation();\n});\n$('.copy-fenxiao-url').click(function(e) {\n  var $temp = $(\"<input>\");\n  $(\"body\").append($temp);\n  $temp.val($(\".fenxiao-popup-fenxiao-url\").text()).select();\n  document.execCommand(\"copy\");\n  $temp.remove();\n});\n</script>", $("body").append($(e)) }, g = function () { var e, n, t, o, i; if (t = /\/product\/(\d+)\//, e = location.pathname.match(t), e && (n = e[1], i = localStorage.getItem("viewed_product"), o = i ? JSON.parse(i) : [], b.call(o, n) < 0)) return o.unshift(e[1]), o.length > 10 && (o = o.slice(0, 10)), i = JSON.stringify(o), localStorage.setItem("viewed_product", i), o.length }, s = function () { if (navigator.userAgent.match(/MicroMessenger/) && location.host.indexOf("wx.danlu.net") === -1 && location.search.indexOf("wx_redirect") > -1) return window.location = "/weixin/wx_redirect" }, p = function () { return d(), m(), f(), w(), u(), x(), g(), s() }, p(), function (e, n, t) { var o = function (e, n, t, o) { var i = e(n); e.fn.lazyload = function (r) { function a() { var n = 0; l.each(function () { var t = e(this); if (!f.skip_invisible || t.is(":visible")) if (e.abovethetop(this, f) || e.leftofbegin(this, f)); else if (e.belowthefold(this, f) || e.rightoffold(this, f)) { if (++n > f.failure_limit) return !1 } else t.trigger("appear"), n = 0 }) } var c, l = this, f = { handler: function (e) { return e }, threshold: 0, failure_limit: 0, event: "scroll", effect: "show", container: n, data_attribute: "original", skip_invisible: !1, appear: null, load: null, placeholder: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" }; return r && (o !== r.failurelimit && (r.failure_limit = r.failurelimit, delete r.failurelimit), o !== r.effectspeed && (r.effect_speed = r.effectspeed, delete r.effectspeed), e.extend(f, r)), c = f.container === o || f.container === n ? i : e(f.container), 0 === f.event.indexOf("scroll") && c.bind(f.event, function () { return a() }), this.each(function () { var n = this, t = e(n); n.loaded = !1, t.attr("src") !== o && t.attr("src") !== !1 || t.is("img") && t.attr("src", f.placeholder), t.one("appear", function () { if (!this.loaded) { if (f.appear) { var o = l.length; f.appear.call(n, o, f) } e("<img />").bind("load", function () { var o = t.attr("data-" + f.data_attribute); t.hide(), t.is("img") ? (o = f.handler(o), t.attr("src", o)) : t.css("background-image", "url('" + o + "')"), t[f.effect](f.effect_speed), n.loaded = !0; var i = e.grep(l, function (e) { return !e.loaded }); if (l = e(i), f.load) { var r = l.length; f.load.call(n, r, f) } }).attr("src", f.handler(t.attr("data-" + f.data_attribute))) } }), 0 !== f.event.indexOf("scroll") && t.bind(f.event, function () { n.loaded || t.trigger("appear") }) }), i.bind("resize", function () { a() }), /(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion) && i.bind("pageshow", function (n) { n.originalEvent && n.originalEvent.persisted && l.each(function () { e(this).trigger("appear") }) }), e(t).ready(function () { a() }), this }, e.belowthefold = function (t, r) { var a; return a = r.container === o || r.container === n ? (n.innerHeight ? n.innerHeight : i.height()) + i.scrollTop() : e(r.container).offset().top + e(r.container).height(), a <= e(t).offset().top - r.threshold }, e.rightoffold = function (t, r) { var a; return a = r.container === o || r.container === n ? i.width() + i.scrollLeft() : e(r.container).offset().left + e(r.container).width(), a <= e(t).offset().left - r.threshold }, e.abovethetop = function (t, r) { var a; return a = r.container === o || r.container === n ? i.scrollTop() : e(r.container).offset().top, a >= e(t).offset().top + r.threshold + e(t).height() }, e.leftofbegin = function (t, r) { var a; return a = r.container === o || r.container === n ? i.scrollLeft() : e(r.container).offset().left, a >= e(t).offset().left + r.threshold + e(t).width() }, e.inviewport = function (n, t) { return !(e.rightoffold(n, t) || e.leftofbegin(n, t) || e.belowthefold(n, t) || e.abovethetop(n, t)) }, e.extend(e.expr[":"], { "below-the-fold": function (n) { return e.belowthefold(n, { threshold: 0 }) }, "above-the-top": function (n) { return !e.belowthefold(n, { threshold: 0 }) }, "right-of-screen": function (n) { return e.rightoffold(n, { threshold: 0 }) }, "left-of-screen": function (n) { return !e.rightoffold(n, { threshold: 0 }) }, "in-viewport": function (n) { return e.inviewport(n, { threshold: 0 }) }, "above-the-fold": function (n) { return !e.belowthefold(n, { threshold: 0 }) }, "right-of-fold": function (n) { return e.rightoffold(n, { threshold: 0 }) }, "left-of-fold": function (n) { return !e.rightoffold(n, { threshold: 0 }) } }) }, i = function () { var t, i, r; if ("undefined" != typeof jQuery) o(jQuery, e, n); else { t = n.getElementsByTagName("img"); for (var a = 0; a < t.length; a++)i = t[a], r = i.getAttribute("data-original"), r && i.setAttribute("src", r) } }; i() }(window, document), function () { if (!/(phantomjs|headlesschrome)/.test(navigator.userAgent.toLowerCase()) && "true" !== localStorage.disable_moddleware) { var e = document.createElement("script"), n = window.location.protocol.split(":")[0]; "https" === n ? e.src = "https://zz.bdstatic.com/linksubmit/push.js" : e.src = "http://push.zhanzhang.baidu.com/push.js"; var t = document.getElementsByTagName("script")[0]; t.parentNode.insertBefore(e, t) } }() }).call(this);
//# sourceMappingURL=middleware.js.map